# QQ一起听音乐插件

<p align="center">
  <strong>AstrBot 一起听音乐插件 - 创建音乐房间，邀请好友一起听歌</strong>
</p>

<p align="center">
  <a href="#功能特性">功能特性</a> •
  <a href="#安装">安装</a> •
  <a href="#使用方法">使用方法</a> •
  <a href="#常见问题">常见问题</a>
</p>

---

## 功能特性

- 🏠 **房间管理** - 创建/加入/退出音乐房间，支持多人同时在线
- 🎵 **多源音乐搜索** - 支持QQ音乐、网易云音乐双平台搜索
- 📋 **播放列表** - 完整的播放列表管理，支持添加/移除/清空
- 🎮 **播放控制** - 播放/暂停/上一首/下一首/切歌
- 🔀 **播放模式** - 顺序播放、随机播放
- 🔗 **直链获取** - 自动获取歌曲播放直链（部分免费歌曲）
- 💬 **群聊讨论** - 听歌结束后群成员可直接讨论感想

## 音乐来源

| 平台 | 搜索 | 直链播放 | 备注 |
|------|:----:|:--------:|------|
| QQ音乐 | ✅ | ✅ | 优先搜索源 |
| 网易云音乐 | ✅ | ✅ | 备用搜索源 |

> ⚠️ **注意**: VIP歌曲、版权受限歌曲可能无法获取直链，会返回歌曲详情页链接供用户手动播放。

## 安装

### 方式一：手动安装

1. 下载插件源码
2. 将插件文件夹放入 AstrBot 的 `addons/plugins/` 目录
3. 重启 AstrBot

### 方式二：Git安装

```bash
cd AstrBot/addons/plugins
git clone https://github.com/Binbim/astrbot_plugin_ListentogetheronQQ.git
```

## 使用方法

### 快速开始

```
用户A: /创建房间
机器人: 🏠 音乐房间创建成功！房主: 用户A

用户B: /加入房间
机器人: ✅ 用户B 加入了音乐房间

用户A: /点歌 稻香
机器人: 搜索结果:
  1. 稻香 - 周杰伦 (3:42) [QQ音乐]
  ...

用户A: /选歌 1
机器人: ✅ 用户A 添加了歌曲

用户A: /播放
机器人: ▶️ 开始播放...
```

### 命令列表

#### 房间管理

| 命令 | 说明 | 权限 |
|------|------|------|
| `/创建房间` | 创建音乐房间 | 所有人 |
| `/加入房间` | 加入当前群的音乐房间 | 所有人 |
| `/退出房间` | 退出当前房间 | 所有人 |
| `/关闭房间` | 关闭音乐房间 | 仅房主 |
| `/房间信息` | 查看房间详情 | 所有人 |

#### 歌曲操作

| 命令 | 说明 | 示例 |
|------|------|------|
| `/点歌 <歌名>` | 搜索歌曲 | `/点歌 稻香` |
| `/选歌 <序号>` | 选择歌曲添加到列表 | `/选歌 1` |
| `/播放列表` | 查看当前播放列表 | - |
| `/移除 <序号>` | 移除指定歌曲 | `/移除 2` |
| `/清空列表` | 清空播放列表 | 仅房主 |

#### 播放控制

| 命令 | 说明 |
|------|------|
| `/播放` | 开始播放 |
| `/暂停` | 暂停播放 |
| `/下一首` | 播放下一首 |
| `/上一首` | 播放上一首 |
| `/切歌 <序号>` | 切换到指定歌曲 |
| `/播放模式 [顺序/随机]` | 设置播放模式 |

#### 其他

| 命令 | 说明 |
|------|------|
| `/听歌帮助` | 查看帮助信息 |

## 使用场景

### 场景一：群聊一起听歌

```
群成员A创建房间 → 其他成员加入 → 点歌、播放 → 大家一起听 → 听完讨论感想
```

### 场景二：分享音乐

```
点歌搜索 → 选择歌曲 → 获取链接 → 分享给好友
```

## 常见问题

### Q: 为什么有些歌曲无法播放？

A: 可能原因：
- 该歌曲为VIP专属歌曲
- 该歌曲有版权限制
- 平台接口暂时不可用

解决方案：尝试搜索其他版本或切换音乐源

### Q: 每个群可以创建几个房间？

A: 每个群只能创建一个音乐房间。如需创建新房间，请先关闭现有房间。

### Q: 房主退出后房间会怎样？

A: 房主需要使用 `/关闭房间` 命令关闭房间后才能退出。房间关闭后所有成员都会被移出。

### Q: 搜索结果来自哪个平台？

A: 优先搜索QQ音乐，如果QQ音乐无结果或失败，会自动切换到网易云音乐搜索。

## 技术架构

```
┌─────────────────────────────────────┐
│           AstrBot Framework          │
├─────────────────────────────────────┤
│         ListenTogetherPlugin         │
├──────────────┬──────────────────────┤
│   QQ音乐API  │    网易云音乐API      │
├──────────────┴──────────────────────┤
│            MusicRoom Manager         │
│   (房间/播放列表/成员管理)            │
└─────────────────────────────────────┘
```

## 依赖

- Python >= 3.10
- aiohttp >= 3.8.0
- AstrBot >= v3.4.0

## 更新日志

### v1.0.0 (2025-02-22)

- ✨ 首次发布
- 🎵 支持QQ音乐、网易云音乐搜索
- 🏠 支持多人音乐房间
- 🎮 完整的播放控制功能

## 许可证

本项目采用 [GNU AGPL v3.0](LICENSE) 许可证开源。

## 支持

- [AstrBot 官方文档](https://astrbot.app)
- [AstrBot GitHub](https://github.com/AstrBotDevs/AstrBot)

---

<p align="center">
  如果觉得这个插件有用，请给个 ⭐️ Star 支持一下！
</p>
